#!/usr/bin/env python
import argparse
import sys
sys.path.append('..')
import time

from miniwan.wannet.wannet import WanNet
from mininet.cli import CLI
from mininet.log import setLogLevel

SYSCTL_SLEEP = 5

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('-t', '--topology', help='topology file', default='../conf/b4.yaml')
    parser.add_argument('-p', '--protocol', help='routing protocol', choices=['bgp', 'ospf'], default='ospf')
    parser.add_argument('-l', '--log', help='log level', choices=['info', 'debug'], default='info')

    args = parser.parse_args()

    setLogLevel(args.log)

    net = WanNet(topo_desc_file=args.topology, protocol=args.protocol)

    net.start()
    for router in net.switches:
        router.enable_route()
    print('wait {} seconds for sysctl changes to take effect...'.format(SYSCTL_SLEEP))
    time.sleep(SYSCTL_SLEEP)
    for router in net.switches:
        router.start_route()
    CLI(net)
    net.stop()
